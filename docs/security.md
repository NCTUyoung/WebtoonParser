# 🔒 安全考量

應用程序實現了多層安全措施，保護用戶數據和系統資源：

### 1. 進程隔離與安全通信

- **Context Isolation (上下文隔離)**: 
  - 在 `BrowserWindow` 的 `webPreferences` 中啟用 `contextIsolation: true`。
  - 這確保渲染進程的 JavaScript 上下文與 Electron 的主進程和預加載腳本的上下文是隔離的，防止渲染進程直接訪問 Node.js API 或 Electron 內部模塊。
- **安全的 IPC 通信**:
  - 使用 `contextBridge` 在預加載腳本中明確暴露有限、安全的 API 給渲染進程。
  - 避免直接暴露 `ipcRenderer` 或其他 Electron API。
  - 對通過 IPC 傳遞的數據進行驗證和清理。
- **禁用 Node Integration**: 
  - 設置 `nodeIntegration: false`，阻止渲染進程直接使用 Node.js 功能。
- **啟用 Sandbox (沙盒)**: 
  - 考慮啟用 `sandbox: true` (如果適用且不影響功能) 以提供更強的進程隔離。

### 2. 資源訪問控制

- **限制渲染進程權限**: 渲染進程本身不應具有直接訪問文件系統或執行任意系統命令的權限。
- **IPC 作為網關**: 所有需要訪問系統資源的操作（如讀寫文件、選擇目錄）都必須通過 IPC 請求主進程來完成。
- **主進程驗證**: 主進程在執行敏感操作（如寫入文件）之前，應驗證請求的合法性（例如，檢查請求的文件路徑是否在允許的範圍內）。

### 3. 網絡安全

- **自定義 User-Agent**: 使用自定義的 `User-Agent` 進行網絡請求，可能減少被目標網站識別和封鎖的風險，但效果有限。
- **請求限制與延遲**: 
  - 在 `WebtoonScraper` 中實現請求頻率限制（例如，使用 `setTimeout` 或更高級的限流庫）。
  - 避免在短時間內向同一網站發送大量請求，尊重目標網站的服務器資源，降低被封鎖的風險。
- **HTTPS**: 確保所有網絡請求都使用 HTTPS。
- **處理網絡錯誤**: 完善的錯誤處理機制，優雅地處理超時、連接錯誤等網絡問題。

### 4. 數據安全

- **本地存儲**: 
  - `electron-store` 將數據存儲在用戶目錄下的 JSON 文件中，通常不需要額外加密，但應避免存儲極度敏感的信息（如密碼）。
  - 如果需要存儲敏感數據，應考慮使用 Node.js 的 `crypto` 模塊或其他加密庫進行加密後再存儲。
- **安全的文件操作**: 
  - 使用 Electron 的 `dialog` 模塊讓用戶明確選擇文件保存路徑，而不是硬編碼或允許任意路徑寫入。
  - 在寫入文件前檢查路徑的有效性。
  - 避免覆蓋用戶現有的重要文件，可以考慮添加時間戳或編號到文件名中。
- **輸入驗證**: 
  - 對所有來自用戶界面（渲染進程）的輸入（如 URL、定時設置）進行嚴格的格式驗證和清理，防止潛在的注入或格式錯誤導致的問題。
  - 使用正則表達式或其他驗證庫驗證 URL 格式。

### 5. 外部鏈接處理

- **安全打開外部鏈接**: 使用 `shell.openExternal(url)` 來在用戶的默認瀏覽器中打開鏈接。這比在應用程序內部加載外部網頁更安全，可以防止潛在的釣魚或惡意網站利用應用程序窗口。
- **驗證 URL**: 在打開外部鏈接前，對 URL 進行基本驗證，確保其看起來是合法的 Webtoon 鏈接。 